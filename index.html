<html>

<head>
<title>Project 2 - INFO 5100 - Data-driven Web Pages</title>
<style>
	body {font-family: "Avant Garde", Avantgarde, "Century Gothic", CenturyGothic, "AppleGothic", sans-serif; padding-right:60px; padding-left: 60px; }
	svg {border: solid #ccc 1px; }
</style>
<script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>

<script>
	//Declare variables
	var movieData = [];
	var awardData = [];

	//organize data
	var parseRow1 = function(line){
		return {
			//Filter data
			duration: Number(line["duration"]),
			genres: line["genres"],
			year: Number(line["title_year"]),
			country: line["country"],
			language: line["language"], //not actual filter

			//Factor data
			actorLikes: Number(line["actor_1_facebook_likes"]),
			budget: Number(line["budget"]),
			gross: Number(line["gross"]),
			score: Number(line["imdb_score"]),
			movieLikes: Number(line["movie_facebook_likes"]),

			//Movie Info data
			title: line["movie_title"],
			keywords: line["plot_keywords"],
			link: line["movie_imdb_link"],
		}
	};

	var parseRow2 = function(line){
		return {
			year: Number(line["Year"]),
			award: line["Award"],
			filmName: line["Film"],
		}
	};

	d3.queue()
	.defer(d3.csv, "movie_metadata.csv", parseRow1)
	.defer(d3.csv, "award.csv", parseRow2)
	.await(function(error, data, award){
		award.forEach(function(d){
			if(d.year>2000){
				awardData.push(d);
			}
		});

		data.forEach(function(d){
			if(d.duration && d.genres && d.year>2000 && d.country && d.language == "English" && d.actorLikes && d.budget && d.gross && d.score && d.movieLikes && d.title && d.keywords && d.link){
				movieData.push(d);
			}
		});

		var count1 = 0;
		var count2 = 0;
		var index = 0;
		movieData.forEach(function(movie){
			awardData.forEach(function(award){
				//** if we compare movies with both name and year, it has 792 movies; if we only check the names, there are 812. And there are 1 film with multiple awards
				//stuck on 1: duplicated awards 2: delete non-awarded films
				if(movie.title.toUpperCase().trim() === award.filmName.toUpperCase()  && movie.year == award.year){
					// if(!movie.award){
					// 	movie.award = award.award;
					// }
					movie.award = award.award;
					count1++;
				}
				else{
					index = movieData.indexOf(movie);
					console.log(index);
					movieData.splice(index,1);
					count2++;
				}
			})
			//console.log(movie.award);
		})

				console.log("1: "+ count1 +" "+ "2: "+count2);
	})
</script>

</body>

</html>